name: "Wise impersonation with suspicious attachment"
description: |
  Impersonating Wise Financial, as confirmed by NLU, and contains a suspicious attachment type.
references:
  
type: "rule"
severity: "high"
source: |
  type.inbound
  and (
        strings.ilike(sender.display_name, '*wise transfer*')
        or strings.ilevenshtein(sender.display_name, 'wise transfer') <= 1
        or strings.ilike(sender.email.domain.domain, '*wise transfer*')
    )
  and any(ml.nlu_classifier(strings.concat(body.html.inner_text, body.html.display_text, body.html.raw)).tags, .name in ("payment", "invoice"))
  and any(attachments, .file_type 
      in~ $file_extensions_common_archives
      or .file_type in~ $file_extensions_executables
      or .file_type in~ $file_extensions_macros
      or .file_type in ("lz")
  )
  and sender.email.domain.root_domain not in~ ('wise.com', 'wise.jobs')
tags: 
  - "Suspicious attachment"
  - "Suspicious body"
  - "Natural Language Understanding"